!function(){function t(t,e,n){return t<e?e:t>n?n:t}function e(t){let e=new URL(document.location.href);e.searchParams.set("Population",""+t.t),e.searchParams.set("DotRadius",""+t.i),e.searchParams.set("RecoveryTime",""+t.o),e.searchParams.set("MoveSpeed",""+t.l),e.searchParams.set("Distancing",(100*t.u).toFixed(0)),history.replaceState(t,"Distancing","?"+e.searchParams)}function n(t=0,e=1){return b=16807*b%2147483647,(b-1)/2147483646*(e-t)+t}function i(t){return(e,n)=>{e.h.s[n]|=2,e.h.m[n]={p:n,v:t,$:[0,0],g:[]}}}function o(t){return{R:[n(0,t.D.width),n(0,t.D.height)],F:n(0,2*Math.PI),M:[(o=t.I.i,(t,e)=>{t.h.s[e]|=4,t.h.S[e]={k:0,v:o,A:t.T}}),i(t.I.i),(e=t.I.l,(t,n)=>{t.h.s[n]|=16,t.h.q[n]={N:e}}),(t,e)=>{t.h.s[e]|=1},(t,e)=>{t.h.s[e]|=64},(t,e)=>{t.h.s[e]|=8,t.h.C[e]={I:"vulnerable",P:0}}]};var e,o}function a(t){let e=performance.now(),n=i=>{t.U((i-e)/1e3),e=i,g=requestAnimationFrame(n)};r(),n(e)}function r(){cancelAnimationFrame(g)}function l(t,{R:e,F:n,L:i,M:o=[],K:a=[]}){let r=function(t,e=0){for(let n=0;n<$;n++)if(!t.s[n])return t.s[n]=e,n;throw Error("No more entities available.")}(t.h);!function(t=[0,0],e=0,n=[1,1]){return(i,o)=>{i.h.s[o]|=32,i.h.W[o]={p:o,h:[1,0,0,1,0,0],j:[1,0,0,1,0,0],R:t,F:e,L:n,K:[],B:1}}}(e,n,i)(t,r);for(let e of o)e(t,r);let u=t.h.W[r];for(let e of a){let n=l(t,e),i=t.h.W[n];i.G=u,u.K.push(i)}return r}function u(t){var e;t.h=new y,t.H=[],e=Date.now(),b=198706*e;for(let e=0;e<t.I.t-1;e++)l(t,o(t));let n=l(t,o(t));t.h.C[n].I="infected",t.h.S[n].A=t.J;for(let e=0;e<t.I.t*t.I.u;e++)1&t.h.s[e]&&(t.h.s[e]&=-17)}function s(t,e){let n=t.h.W[e];n.R[0]<0&&(n.R[0]=0,n.F=Math.PI-n.F,n.B=1),n.R[0]>t.D.width&&(n.R[0]=t.D.width,n.F=Math.PI-n.F,n.B=1),n.R[1]<0&&(n.R[1]=0,n.F=-n.F,n.B=1),n.R[1]>t.D.height&&(n.R[1]=t.D.height,n.F=-n.F,n.B=1)}function c(t,e,n){for(let a=n;a<e.length;a++){let n=e[a];n!==t&&function(t,e){let n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}((i=t).$,(o=n).$)<(i.v+o.v)**2&&(t.g.push(n),n.g.push(t))}var i,o}function f(t,e){t.O.fillStyle=e.A,t.O.beginPath(),t.O.arc(0,0,e.v,0,2*Math.PI),t.O.closePath(),t.O.fill()}function h(t,e,n){let i=t.h.C[e];if("infected"===i.I){if(i.P+=n,i.P>t.I.o)return i.I="recovered",t.h.S[e].A=t.V,void(t.h.s[e]&=-3);let o=t.h.m[e];for(let e=0;e<o.g.length;e++){let n=o.g[e];"vulnerable"===t.h.C[n.p].I&&(t.h.C[n.p].I="infected",t.h.S[n.p].A=t.J)}}}function d(t,e,n){let i=t.h.W[e],o=t.h.q[e];M[0]=i.h[0],M[1]=i.h[1],i.R[0]+=M[0]*o.N*n,i.R[1]+=M[1]*o.N*n,i.B=1}function m(t,...e){return t.reduce((t,n)=>t+function(t){let e=t.shift();return"boolean"==typeof e||null==e?"":Array.isArray(e)?e.join(""):e}(e)+n)}function p(t,e){let i=t.h.W[e];i.F+=n(-.1,.1),i.B=1}const v={t:500,i:3,o:15,l:50,u:0};let b=1;const $=1e4;let g=0;class y{constructor(){this.s=[],this.m=[],this.S=[],this.C=[],this.q=[],this.W=[]}}let R,w=document.getElementById("update"),D=document.getElementById("delta"),F=document.getElementById("fps"),M=[0,0],I=0,S=new class{constructor(){this.h=new y,this.X=document.querySelector("#controls"),this.D=document.querySelector("canvas#scene"),this.O=this.D.getContext("2d"),this.Y=document.querySelector("canvas#histo"),this.Z=this.Y.getContext("2d"),this._="#e2ddc3",this.T="#fafafa",this.J="#ce6a12",this.V="#9582dd",this.H=[],this.I={...v},document.addEventListener("visibilitychange",()=>document.hidden?r():a(this)),this.Y.width=800,this.Y.height=100,this.D.width=800,this.D.height=600,function(e){let n,i=new URL(document.location.href).searchParams;n=i.get("Population"),null!==n&&(n=parseInt(n),Number.isNaN(n)||(e.t=t(n,1,1e3))),n=i.get("DotRadius"),null!==n&&(n=parseInt(n),Number.isNaN(n)||(e.i=t(n,1,10))),n=i.get("RecoveryTime"),null!==n&&(n=parseInt(n),Number.isNaN(n)||(e.o=t(n,1,30))),n=i.get("MoveSpeed"),null!==n&&(n=parseInt(n),Number.isNaN(n)||(e.l=t(n,1,100))),n=i.get("Distancing"),null!==n&&(n=parseInt(n),Number.isNaN(n)||(e.u=t(n,0,1)))}(this.I)}U(t){let e=performance.now();!function(t,e){for(let n=0;n<t.h.s.length;n++)48==(48&t.h.s[n])&&d(t,n,e)}(this,t),function(t,e){for(let e=0;e<t.h.s.length;e++)33==(33&t.h.s[e])&&s(t,e)}(this),function(t,e){for(let e=0;e<t.h.s.length;e++)96==(96&t.h.s[e])&&p(t,e)}(this),function(t,e){for(let e=0;e<t.h.s.length;e++)32==(32&t.h.s[e])&&(i=void 0,o=void 0,(n=t.h.W[e]).B&&(n.B=0,function t(e){for(let n of e.K)n.B=1,t(n)}(n),o=n.R,(i=n.h)[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=o[0],i[5]=o[1],function(t,e,n){let i=e[0],o=e[1],a=e[2],r=e[3],l=e[4],u=e[5],s=Math.sin(n),c=Math.cos(n);t[0]=i*c+a*s,t[1]=o*c+r*s,t[2]=i*-s+a*c,t[3]=o*-s+r*c,t[4]=l,t[5]=u}(n.h,n.h,n.F),function(t,e,n){let i=e[1],o=e[2],a=e[3],r=e[4],l=e[5],u=n[0],s=n[1];t[0]=e[0]*u,t[1]=i*u,t[2]=o*s,t[3]=a*s,t[4]=r,t[5]=l}(n.h,n.h,n.L),n.G&&function(t,e,n){let i=e[0],o=e[1],a=e[2],r=e[3],l=e[4],u=e[5],s=n[0],c=n[1],f=n[2],h=n[3],d=n[4],m=n[5];t[0]=i*s+a*c,t[1]=o*s+r*c,t[2]=i*f+a*h,t[3]=o*f+r*h,t[4]=i*d+a*m+l,t[5]=o*d+r*m+u}(n.h,n.G.h,n.h),function(t,e){let n=e[0],i=e[1],o=e[2],a=e[3],r=e[4],l=e[5],u=n*a-i*o;u&&(u=1/u,t[0]=a*u,t[1]=-i*u,t[2]=-o*u,t[3]=n*u,t[4]=(o*l-a*r)*u,t[5]=(i*r-n*l)*u)}(n.j,n.h)));var n,i,o}(this),function(t,e){let n=[];for(let e=0;e<t.h.s.length;e++)if(34==(34&t.h.s[e])){let a=t.h.W[e],r=t.h.m[e];r.g=[],(i=r.$)[0]=(o=a.h)[4],i[1]=o[5],n.push(r)}var i,o;for(let t=0;t<n.length;t++)c(n[t],n,t+1)}(this),function(t,e){for(let n=0;n<t.h.s.length;n++)10==(10&t.h.s[n])&&h(t,n,e)}(this,t),function(t,e){if(I+=e,I>.06){I=0;let e=[0,0,0];for(let n=0;n<t.h.s.length;n++)if(8==(8&t.h.s[n]))switch(t.h.C[n].I){case"vulnerable":e[0]++;break;case"infected":e[1]++;break;case"recovered":e[2]++}t.H.push(e)}}(this,t),function(t,e){t.O.resetTransform(),t.O.fillStyle=t._,t.O.fillRect(0,0,t.D.width,t.D.height);for(let e=0;e<t.h.s.length;e++)if(36==(36&t.h.s[e])){let n=t.h.W[e];t.O.setTransform(n.h[0],n.h[1],n.h[2],n.h[3],n.h[4],n.h[5]);let i=t.h.S[e];switch(i.k){case 0:f(t,i)}}}(this),function(t,e){t.Z.clearRect(0,0,t.Y.width,t.Y.height);for(let e=0;e<t.H.length;e++){let n=t.H[e],i=n[0]/t.I.t*t.Y.height,o=n[1]/t.I.t*t.Y.height,a=n[2]/t.I.t*t.Y.height;t.Z.fillStyle=t.V,t.Z.fillRect(1*e,0,1,a),t.Z.fillStyle=t.T,t.Z.fillRect(1*e,a,1,i),t.Z.fillStyle=t.J,t.Z.fillRect(1*e,a+i,1,o)}}(this),function(t,e){let n=m`<div><div>${function(t){return m`<label><span>Population: ${t.t}</span><inputtype="range"min="1"max="1000"value="${t.t}"onchange="$(${0}, parseInt(this.value))"/></label>`}(i=t.I)} ${function(t){return m`<label><span>Dot Radius: ${t.i}px</span><inputtype="range"min="1"max="10"value="${t.i}"onchange="$(${1}, parseFloat(this.value))"/></label>`}(i)} ${function(t){return m`<label><span>Recovery Time: ${t.o}s</span><inputtype="range"min="1"max="30"value="${t.o}"onchange="$(${2}, parseInt(this.value))"/></label>`}(i)} ${function(t){return m`<label><span>Movement: ${t.l}px/s</span><inputtype="range"min="1"max="100"value="${t.l}"onchange="$(${3}, parseFloat(this.value))"/></label>`}(i)}${function(t){return m`<label><span>Distancing: ${Math.round(100*t.u)}%</span><inputtype="range"min="0"max="1"step="0.01"value="${t.u}"onchange="$(${4}, parseFloat(this.value))"/></label>`}(i)}</div><div style="margin-top: 20px;"><button onclick="$(${0}, ${i.t})">Restart Simulation</button><button onclick="$(${5})">Reset Parameters</button></div></div>`;var i;n!==R&&(t.X.innerHTML=R=n)}(this),function(t,e,n){w&&(w.textContent=n.toFixed(1)),D&&(D.textContent=(1e3*e).toFixed(1)),F&&(F.textContent=(1/e).toFixed())}(0,t,performance.now()-e)}};u(S),a(S),window.game=S,window.$=function(n,i,o){switch(i){case 0:n.I.t=t(o,1,1e3),e(n.I),requestAnimationFrame(()=>u(n));break;case 1:n.I.i=t(o,1,10),e(n.I),requestAnimationFrame(()=>(function(t){for(let e=0;e<t.h.s.length;e++)4&t.h.s[e]&&(t.h.S[e].v=t.I.i),2&t.h.s[e]&&(t.h.m[e].v=t.I.i)})(n));break;case 2:n.I.o=t(o,1,30),e(n.I);break;case 3:n.I.l=t(o,1,100),e(n.I),requestAnimationFrame(()=>(function(t){for(let e=0;e<t.h.s.length;e++)t.h.q[e]&&(t.h.q[e].N=t.I.l)})(n));break;case 4:n.I.u=t(o,0,1),e(n.I),requestAnimationFrame(()=>(function(t){let e=t.I.t*t.I.u;for(let n=0;n<t.h.s.length;n++)1&t.h.s[n]&&(n<e?t.h.s[n]&=-17:t.h.s[n]|=16)})(n));break;case 5:n.I={...v},e(n.I),requestAnimationFrame(()=>u(n))}}.bind(null,S)}();
